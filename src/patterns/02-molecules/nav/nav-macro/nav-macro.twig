{#
# nav-marco.twig
#
# Outputs an unordered list of items from a wordpress menu
#
# VARIABLES
# menu     = menu.get_items
# class    = css class for BEM
# navClass = classes for the main nav
#
#}
{% spaceless %}
    {% macro menu(menu, class, navClass, parent_class, drop, show_nested_menu = true) %}
        {% import _self as nav %}
        {% set class = class ? class : 'dod-menu' %}

        <ul class="{{ parent_class }}__nav {{ class }} {{ navClass }}">
            {% for index, items in menu %}
                {% set show_children = items.get_children and show_nested_menu ? true : false %}
                {{ nav.item(items, class, drop, index, show_children) }}
            {% endfor %}
        </ul>
    {% endmacro %}
    {% macro item(item, class, drop, index, show_children) %}
        {% import _self as nav %}
        <li class="{{ class }}__item {{ class }}__item--level-{{ item.level }} {{ class }}__item-{{ index }} {{ item.classes|join(' ') }}">
            {% if show_children %}
                {{ nav.link(item, class, show_children) }}
                {% if drop == true %}
                    {% if ('current_page_ancestor' in item.classes) or ('current-menu-item' in item.classes) %}
                        {% set active = 'a-plus-toggle--opened' %}
                    {% endif %}
                    <div class="{{ class }}__toggle-wrapper js-nav-drop">
                        <div class="{{ class }}__plus-toggle a-plus-toggle js-plus-toggle">
                            <span class="{{ class }}__plus-toggle__line a-plus-toggle__line"></span>
                        </div>
                    </div>

                {% endif %}
                <ul class="{{ class }}__sub-menu {{ class }}__sub-menu--level-{{ item.level }}">
                    {% for child in item.get_children %}
                        {{ nav.item(child, class, drop) }}
                    {% endfor %}
                </ul>
            {% else %}
                {{ nav.link(item, class, show_children) }}
            {% endif %}
        </li>
    {% endmacro %}
    {% macro link(item, class, arrow, show_children) %}
        <a href="{{ item.get_link }}" {{ item._menu_item_target ? "target='_blank'" }}
           class="{{ class }}__link {{ class }}__link--level-{{ item.level }} js-nav-link {{ item.classes|join(' ') }}"><span class="{{ class }}__link-text">{{ item.title }}</span>{{ show_children ? '<span class="m-nav__arrow c-arrow-toggle"><i class="fa fa-sort-desc" aria-hidden="true"></i></span>' : ''}}</a>
    {% endmacro %}
{% endspaceless %}
